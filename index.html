<title>AU_WARN</title><b>AU EMERGENCY</b><br><input id=A size=2><input id=B size=2><button onclick=g()>Go</button><button onclick=n()>GPS</button><p id=M style=margin:2px></p><div id=W style=font-size:11px;color:red;font-weight:700></div><pre id=O style=font-size:10px;margin:0></pre><div style=font-size:9px;color:#666>AFDRS: 0:MOD 24:HIGH 50:EXTR 100:CATA</div><script>
L=localStorage;A.value=L.a||'';B.value=L.b||'';
R=(j,u,d,h)=>{
  M.innerText=`${u?'OK':'Last'}|${u||L.u||''}`;
  d=j.daily;
  // Australian Fire Danger Rating mapping
  f=d.fire_danger_index[0];
  v=f>=100?'CATASTROPHIC':f>=50?'EXTREME':f>=24?'HIGH':'MODERATE';
  W.innerHTML=f>=50?`!!! ${v} FIRE DANGER !!!` : `Rating: ${v}`;
  O.innerText='7-DAY FIRE OUTLOOK\nDATE  INDEX  RATING\n';
  d.time.map((t,i)=>{
    x=d.fire_danger_index[i];
    z=x>=100?'CATA':x>=50?'EXTR':x>=24?'HIGH':'MOD';
    O.innerText+=`${t.slice(8,10)}    ${Math.round(x)}    ${z}\n`
  })
};
if(L.j)R(JSON.parse(L.j),0);
n=()=>navigator.geolocation.getCurrentPosition(p=>{A.value=p.coords.latitude.toFixed(2);B.value=p.coords.longitude.toFixed(2);g()},()=>M.innerText='X');
g=async(x,y)=>{
  L.a=x=A.value;L.b=y=B.value;M.innerText='...';
  const c=new AbortController(),t=setTimeout(()=>c.abort(),9000);
  try{
    // Fetching FWI (Fire Weather Index) which AFDRS is based on
    j=await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${x}&longitude=${y}&daily=fire_danger_index&timezone=auto`,{signal:c.signal})).json();
    clearTimeout(t);
    L.u=u=new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
    L.j=JSON.stringify(j);R(j,u)
  }catch(e){M.innerText='Err'}
};
</script>
